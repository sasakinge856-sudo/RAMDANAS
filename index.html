<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Ø±Ø­Ù„Ø© Ø±Ù…Ø¶Ø§Ù† - Ø£Ù„ØºØ§Ø²</title>

  <style>
    :root{
      --bg1:#050814;
      --bg2:#0a2140;
      --text:#eaf3ff;
      --muted:rgba(234,243,255,.72);
      --stroke: rgba(255,255,255,.14);

      --gold1:#f6d37a;
      --gold2:#caa34a;

      --pink1:#ff6ad5;
      --pink2:#ff2ea6;

      --shadow: 0 18px 60px rgba(0,0,0,.45);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1100px 800px at 75% 10%, rgba(246,211,122,.14), transparent 55%),
        radial-gradient(900px 650px at 20% 85%, rgba(89,210,255,.12), transparent 60%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
      overflow:hidden;
    }

    /* floating ramadan emojis background */
    .emoji-sky{ position:fixed; inset:0; overflow:hidden; pointer-events:none; }
    .e{
      position:absolute;
      font-size: clamp(18px, 3.6vw, 34px);
      opacity:.95;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.35));
      animation: floatUp linear infinite;
      will-change: transform, opacity;
    }
    @keyframes floatUp{
      from{ transform: translate3d(var(--dx1), 110vh, 0) rotate(var(--r)); opacity:0; }
      12%{ opacity: .95; }
      to{ transform: translate3d(var(--dx1), -25vh, 0) rotate(calc(var(--r) + 120deg)); opacity:0; }
    }

    .vignette{ position:fixed; inset:0; pointer-events:none;
      background: radial-gradient(circle at 50% 40%, transparent 35%, rgba(0,0,0,.62) 85%);
      mix-blend-mode: multiply;
    }
    .shimmer{ position:fixed; inset:-40%; pointer-events:none;
      background: conic-gradient(from 220deg,
        transparent 0 18%,
        rgba(246,211,122,.10) 20%,
        transparent 26%,
        rgba(89,210,255,.08) 32%,
        transparent 40%,
        rgba(255,95,209,.06) 46%,
        transparent 60%,
        rgba(246,211,122,.08) 72%,
        transparent 100%);
      filter: blur(26px);
      opacity:.55;
      animation: slowSpin 18s linear infinite;
    }
    @keyframes slowSpin{ to{ transform: rotate(360deg); } }

    .wrap{
      position:relative;
      height:100%;
      display:grid;
      place-items:center;
      padding: 18px 14px 64px;
    }
    .scene{
      width:min(860px, 96vw);
      display:none;
      animation: fadeIn .45s ease both;
    }
    .scene.active{ display:block; }
    @keyframes fadeIn{
      from{ opacity:0; transform: translate3d(0, 10px, 0) scale(.99); }
      to{ opacity:1; transform: translate3d(0,0,0) scale(1); }
    }

    /* cards */
    .card{
      background: rgba(10, 16, 30, .62);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 22px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      padding: 18px 16px;
      position:relative;
      overflow:hidden;
    }

    .title{
      margin:0;
      font-size: clamp(22px, 4.8vw, 36px);
      text-shadow: 0 10px 25px rgba(0,0,0,.35);
      text-align:center;
    }
    .sub{
      margin: 10px 0 0;
      color: var(--muted);
      line-height: 1.75;
      font-size: clamp(14px, 3.7vw, 16px);
      white-space: pre-wrap;
    }

    /* glass buttons */
    .glass-row{ display:grid; gap:12px; margin-top:14px; }
    .glass-btn{
      width:100%;
      border:none;
      border-radius: 18px;
      padding: 14px 16px;
      cursor:pointer;
      color: var(--text);
      font-weight: 900;
      font-size: clamp(16px, 4vw, 18px);
      background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: 0 16px 48px rgba(0,0,0,.35);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      position:relative;
      overflow:hidden;
      transition: transform .14s ease;
    }
    .glass-btn:active{ transform: scale(.99); }

    /* buttons */
    .btn{
      width:100%;
      border:none;
      border-radius: 16px;
      padding: 14px 16px;
      font-weight: 1000;
      font-size: clamp(16px, 4vw, 18px);
      cursor:pointer;
      color:#140c06;
      background: linear-gradient(135deg, var(--gold1), var(--gold2));
      box-shadow: 0 14px 38px rgba(0,0,0,.35);
    }
    .btn.pink{
      color:white;
      background: linear-gradient(135deg, #ff6ad5, #ff2ea6);
      filter: drop-shadow(0 0 18px rgba(255,80,200,.35));
    }
    .btn:active{ transform: scale(.99); }

    .row{ display:grid; gap:10px; margin-top:12px; }

    .field{
      width:100%;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.28);
      color: var(--text);
      padding: 12px;
      outline:none;
      font-size: 16px;
    }
    textarea.field{ min-height: 120px; resize: vertical; }

    .hintline{
      margin-top:10px;
      font-size: 13px;
      color: rgba(234,243,255,.70);
      min-height: 18px;
    }
    .ok{ color: rgba(125,255,179,.92); }
    .bad{ color: rgba(255,130,130,.92); }

    body.flash-red{ animation: redFlash .65s ease-in-out; }
    @keyframes redFlash{
      55%{
        background: radial-gradient(1200px 800px at 50% 40%, rgba(255,43,43,.30), transparent 55%),
                   linear-gradient(160deg, #210000, #0e0000) !important;
      }
    }

    /* memory game (NO 3D) */
    .grid16{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 12px;
    }
    .mcard{
      height: 78px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.05));
      box-shadow: 0 14px 38px rgba(0,0,0,.28);
      cursor:pointer;
      position:relative;
      overflow:hidden;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      transition: transform .12s ease;
    }
    .mcard:active{ transform: scale(.99); }
    .mfront, .mback{
      position:absolute; inset:0;
      display:grid; place-items:center;
      border-radius: 18px;
      transition: opacity .18s ease;
    }
    .mfront{ font-weight: 1000; font-size: 22px; opacity:1; color: rgba(234,243,255,.85); }
    .mback{ font-size: 34px; opacity:0; filter: drop-shadow(0 10px 18px rgba(0,0,0,.35)); }
    .mcard.revealed .mfront{ opacity:0; }
    .mcard.revealed .mback{ opacity:1; }
    .mcard.matched{ outline: 2px solid rgba(125,255,179,.35); cursor:default; }

    /* emoji name puzzle */
    .emoji-clue{
      font-size: 34px;
      text-align:center;
      padding: 14px 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      box-shadow: 0 14px 38px rgba(0,0,0,.28);
      margin-top: 12px;
    }

    /* Simon */
    .pads{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 12px;
    }
    .pad{
      height: 100px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      box-shadow: 0 14px 38px rgba(0,0,0,.28);
      display:grid;
      place-items:center;
      font-size: 34px;
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, filter .12s ease;
    }
    .pad:active{ transform: scale(.99); }
    .pad.on{
      filter: drop-shadow(0 0 18px rgba(246,211,122,.45));
      outline: 2px solid rgba(246,211,122,.35);
    }

    /* Word build */
    .tiles{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top: 12px;
      justify-content:center;
    }
    .tile{
      min-width: 56px;
      height: 56px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      box-shadow: 0 14px 38px rgba(0,0,0,.22);
      display:grid;
      place-items:center;
      font-size: 24px;
      font-weight: 900;
      cursor:pointer;
      user-select:none;
    }
    .built{
      margin-top: 10px;
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.24);
      text-align:center;
      font-size: 18px;
      font-weight: 900;
      letter-spacing: .4px;
    }

    /* Doors */
    .doors{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 12px;
    }
    .door{
      height: 130px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      box-shadow: 0 14px 38px rgba(0,0,0,.28);
      display:grid;
      place-items:center;
      cursor:pointer;
      user-select:none;
      padding: 10px;
      text-align:center;
      line-height:1.4;
    }
    .door .dicon{ font-size: 34px; margin-bottom: 6px; }
    .door:active{ transform: scale(.99); }

    /* XO */
    .xo-board{ display:grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top:12px; }
    .xo-cell{
      height: 90px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      box-shadow: 0 14px 38px rgba(0,0,0,.28);
      display:grid;
      place-items:center;
      font-size: 34px;
      font-weight: 900;
      cursor:pointer;
      user-select:none;
    }
    .xo-cell:active{ transform: scale(.99); }
    .xo-cell.disabled{ cursor:default; opacity:.85; }

    /* black emoji puzzle screen */
    body.darkmode{ background: #06060b !important; }
    body.darkmode .emoji-sky, body.darkmode .shimmer, body.darkmode .vignette{ display:none; }
    .emoji-boxes{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-top: 14px;
    }
    .ebox{
      height: 110px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      display:grid;
      place-items:center;
      cursor:pointer;
      box-shadow: 0 18px 50px rgba(0,0,0,.55);
    }
    .ebox span{ font-size: 40px; animation: bob 1.6s ease-in-out infinite; }
    @keyframes bob{ 0%,100%{ transform: translateY(0); } 50%{ transform: translateY(-8px); } }

    /* final sequence puzzle */
    .seq{ display:grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 12px; }
    .seqbtn{
      height: 72px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      box-shadow: 0 14px 38px rgba(0,0,0,.28);
      cursor:pointer;
      display:grid;
      place-items:center;
      font-size: 30px;
      user-select:none;
      transition: transform .14s ease;
    }
    .seqbtn:active{ transform: scale(.99); }

    .footer{
      position:fixed;
      left:0; right:0; bottom:10px;
      text-align:center;
      font-size: 13px;
      color: rgba(234,243,255,.65);
      text-shadow: 0 10px 25px rgba(0,0,0,.55);
      pointer-events:none;
      padding: 0 10px;
    }
  </style>
</head>

<body>
  <div class="emoji-sky" id="emojiSky" aria-hidden="true"></div>
  <div class="shimmer" aria-hidden="true"></div>
  <div class="vignette" aria-hidden="true"></div>

  <main class="wrap">

    <!-- 1) Who -->
    <section class="scene active" id="sc-who">
      <div class="card">
        <h1 class="title">Ø§Ù†Øª Ù…ÙŠÙ†ØŸ</h1>
        <p class="sub" style="text-align:center">Ø§Ø®ØªØ§Ø±â€¦ Ø¨Ø³ Ø§Ø®ØªØ§Ø± Ø¨Ø¹Ù†Ø§ÙŠØ© ğŸ˜ˆ</p>
        <div class="glass-row">
          <button class="glass-btn" data-next="sc-pass1">Ù…Ø¹Ø±ÙØ´.</button>
          <button class="glass-btn" data-next="sc-pass1">Ø§Ù†Ø§ Ù„Ù‚ÙŠØª Ù†ÙØ³ÙŠ Ù‡Ù†Ø§.</button>
        </div>
      </div>
    </section>

    <!-- 2) Password -->
    <section class="scene" id="sc-pass1">
      <div class="card">
        <h1 class="title">Ù„ØºØ² Ù¡</h1>
        <p class="sub">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±: Ø­Ø§Ø¬Ø© Ø¨ØªØ¹Ù…Ù„ÙŠÙ‡Ø§ ÙƒÙ„ ÙŠÙˆÙ…â€¦ ÙˆÙ…Ø´ Ø¨ØªØ¹Ù…Ù„ÙŠ ØºÙŠØ±Ù‡Ø§ ğŸ˜­</p>

        <div class="row">
          <input class="field" id="pass1" placeholder="Ø§ÙƒØªØ¨ÙŠ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±..." autocomplete="off" />
          <button class="btn" id="btnPass1" type="button">ØªØ­Ù‚Ù‘Ù‚</button>
          <div class="hintline" id="err1"></div>
        </div>
      </div>
    </section>

    <!-- Ramadan Note (Reusable) -->
    <section class="scene" id="sc-note">
      <div class="card">
        <h1 class="title">ğŸŒ™ Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ…</h1>
        <div class="sub" id="noteText" style="max-height:55vh; overflow:auto; padding-left:6px"></div>
        <div class="row">
          <button class="btn pink" id="noteBtn" type="button">Ø§Ø³ØªÙ…Ø±Ø§Ø±</button>
        </div>
      </div>
    </section>

    <!-- 3) Memory Intro -->
    <section class="scene" id="sc-mem-intro">
      <div class="card">
        <h1 class="title">Ù„ØºØ² Ù¢</h1>
        <p class="sub">Ù„Ø¹Ø¨Ø© Ù…Ø·Ø§Ø¨Ù‚Ø© 4Ã—4 â€” Ù„Ø§Ø²Ù… ØªÙ„Ø§Ù‚ÙŠ ÙƒÙ„ Ø²ÙˆØ¬ (ğŸ˜‚ Ù…Ø¹ ğŸ˜‚ â€¦) Ø¹Ø´Ø§Ù† ØªÙƒÙ…Ù„.</p>
        <button class="btn" id="btnStartMemory" type="button">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
      </div>
    </section>

    <!-- 4) Memory -->
    <section class="scene" id="sc-memory">
      <div class="card">
        <h1 class="title">Ø·Ø§Ø¨Ù‚ÙŠ Ø§Ù„Ø£Ø²ÙˆØ§Ø¬</h1>
        <p class="sub">Ø§Ù‚Ù„Ø¨ÙŠ ÙƒØ§Ø±ØªÙŠÙ†â€¦ Ù„Ùˆ Ù†ÙØ³ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ ÙŠØ«Ø¨ØªÙˆØ§. Ù„Ùˆ Ù…Ø®ØªÙ„ÙÙŠÙ† ÙŠØ±Ø¬Ø¹ÙˆØ§ ØªØ§Ù†ÙŠ.</p>

        <div class="grid16" id="memoryGrid"></div>

        <div class="row">
          <div class="hintline" id="memStatus">ØªÙ…: 0 / 8</div>
          <button class="btn pink" id="btnMemContinue" type="button" style="display:none">Ø§Ø³ØªÙ…Ø±Ø§Ø±</button>
        </div>
      </div>
    </section>

    <!-- 5) New Puzzle A: Girl name by emojis -->
    <section class="scene" id="sc-ename">
      <div class="card">
        <h1 class="title">Ù„ØºØ² Ù£</h1>
        <p class="sub">Ø§Ø³Ù… Ø¨Ù†Øªâ€¦ Ø¨Ø³ Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ. Ø§ÙƒØªØ¨ÙŠ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ØµØ­ ğŸ‘€</p>

        <div class="emoji-clue" id="enameClue">ğŸ’¡ âœ¨ ğŸŒ™</div>

        <div class="row">
          <input class="field" id="enameInput" placeholder="Ø§ÙƒØªØ¨ÙŠ Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§..." autocomplete="off" />
          <button class="btn" id="btnEnameCheck" type="button">ØªØ­Ù‚Ù‘Ù‚</button>
          <button class="btn" id="btnEnameHint" type="button">ØªÙ„Ù…ÙŠØ­</button>
          <div class="hintline" id="enameMsg"></div>
        </div>
      </div>
    </section>

    <!-- 6) New Puzzle B: Simon sequence -->
    <section class="scene" id="sc-simon">
      <div class="card">
        <h1 class="title">Ù„ØºØ² Ù¤</h1>
        <p class="sub">Ø§Ø­ÙØ¸ÙŠ Ø§Ù„ØªØ±ØªÙŠØ¨ ÙˆÙƒØ±Ø±ÙŠÙ‡â€¦ (ØµØ¹Ø¨ Ø¨Ø³ ÙŠÙ†ÙØ¹) ğŸ˜ˆ</p>

        <div class="pads" id="pads">
          <div class="pad" data-i="0">ğŸŒ™</div>
          <div class="pad" data-i="1">â­</div>
          <div class="pad" data-i="2">ğŸ•Œ</div>
          <div class="pad" data-i="3">âœ¨</div>
        </div>

        <div class="row">
          <button class="btn" id="btnSimonStart" type="button">Ø§Ø¨Ø¯Ø£ / Ø§Ø¹Ø±Ø¶ Ø§Ù„ØªØ±ØªÙŠØ¨</button>
          <button class="btn" id="btnSimonReplay" type="button" style="display:none">Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶</button>
          <div class="hintline" id="simonMsg"></div>
        </div>
      </div>
    </section>

    <!-- 7) New Puzzle C: Word build -->
    <section class="scene" id="sc-word">
      <div class="card">
        <h1 class="title">Ù„ØºØ² Ù¥</h1>
        <p class="sub">ÙƒÙˆÙ‘Ù†ÙŠ ÙƒÙ„Ù…Ø© Ù…Ù† Ø§Ù„Ø­Ø±ÙˆÙâ€¦ (Ø§Ù„ÙƒÙ„Ù…Ø©: Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø±Ù…Ø¶Ø§Ù†) ğŸ‘¿</p>

        <div class="tiles" id="tiles"></div>
        <div class="built" id="built">...</div>

        <div class="row">
          <button class="btn" id="btnWordBack" type="button">Ù…Ø³Ø­ Ø¢Ø®Ø± Ø­Ø±Ù</button>
          <button class="btn" id="btnWordReset" type="button">Ø¥Ø¹Ø§Ø¯Ø©</button>
          <button class="btn" id="btnWordHint" type="button">ØªÙ„Ù…ÙŠØ­</button>
          <div class="hintline" id="wordMsg"></div>
        </div>
      </div>
    </section>

    <!-- 8) New Puzzle D: Doors logic -->
    <section class="scene" id="sc-doors">
      <div class="card">
        <h1 class="title">Ù„ØºØ² Ù¦</h1>
        <p class="sub">Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„Ø¨Ø§Ø¨ Ø§Ù„ØµØ­â€¦ Ø¨Ø³ Ø®Ù„ÙŠ Ø¨Ø§Ù„Ùƒ: â€œØ¬Ù…Ù„Ø© ÙˆØ§Ø­Ø¯Ø© Ø¨Ø³â€ Ù…Ù† Ø¯ÙˆÙ„ ØµØ­ ğŸ‘€</p>

        <div class="doors">
          <div class="door" data-door="1">
            <div class="dicon">ğŸšª</div>
            <div>Ø§Ù„Ø¨Ø§Ø¨ Ø§Ù„ØµØ­ <b>Ù„ÙŠØ³ Ù‡Ø°Ø§</b>.</div>
          </div>
          <div class="door" data-door="2">
            <div class="dicon">ğŸšª</div>
            <div>Ø§Ù„Ø¨Ø§Ø¨ Ø§Ù„ØµØ­ <b>Ù‡Ùˆ Ù‡Ø°Ø§</b>.</div>
          </div>
          <div class="door" data-door="3">
            <div class="dicon">ğŸšª</div>
            <div>Ø§Ù„Ø¨Ø§Ø¨ Ø§Ù„ØµØ­ <b>Ù„ÙŠØ³ Ø§Ù„Ø«Ø§Ù†ÙŠ</b>.</div>
          </div>
        </div>

        <div class="row">
          <button class="btn" id="btnDoorsHint" type="button">ØªÙ„Ù…ÙŠØ­</button>
          <div class="hintline" id="doorsMsg"></div>
        </div>
      </div>
    </section>

    <!-- 9) XO -->
    <section class="scene" id="sc-xo">
      <div class="card">
        <h1 class="title">Ù„ØºØ² Ù§</h1>
        <p class="sub">XO Ø¶Ø¯ ÙƒÙ…Ø¨ÙŠÙˆØªØ± ØµØ¹Ø¨ Ø¨Ø¯Ø±Ø¬Ø© Ø¨Ø³ÙŠØ·Ø©. Ø¥Ù†ØªÙ: âŒ â€” Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±: â­•</p>

        <div class="xo-board" id="xoBoard"></div>
        <div class="hintline" id="xoStatus">Ø¯ÙˆØ±Ùƒ.</div>

        <div class="row">
          <button class="btn" id="xoRestart" type="button">Ø¥Ø¹Ø§Ø¯Ø©</button>
        </div>
      </div>
    </section>

    <!-- 10) Message -->
    <section class="scene" id="sc-message">
      <div class="card">
        <h1 class="title">Ø±Ø³Ø§Ù„ØªÙƒ âœï¸</h1>
        <p class="sub">ÙƒÙ„ Ø§Ù„Ù„ÙŠ Ù‡ØªÙƒØªØ¨ÙŠÙ†Ù‡ Ù‡Ù†Ø§ Ù‡ÙŠÙˆØµÙ„Ù†ÙŠ. Ø§ÙƒØªØ¨ÙŠ Ø£ÙŠ Ø­Ø§Ø¬Ø©â€¦</p>

        <form class="row" id="msgForm" action="https://formspree.io/f/mykdkqza" method="POST">
          <textarea class="field" name="message" id="msgText" placeholder="Ø§ÙƒØªØ¨ÙŠ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." required></textarea>
          <input type="hidden" name="page" id="msgPage" />
          <input type="hidden" name="_subject" value="Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø±Ø­Ù„Ø© Ø§Ù„Ø£Ù„ØºØ§Ø²" />
          <input type="text" name="_gotcha" style="display:none" />
          <button class="btn pink" id="msgSend" type="submit">Ø¥Ø±Ø³Ø§Ù„</button>
          <div class="hintline" id="msgHint"></div>
        </form>
      </div>
    </section>

    <!-- 11) Black emoji puzzle -->
    <section class="scene" id="sc-emoji">
      <div class="card">
        <h1 class="title">Ù„ØºØ² Ù¨</h1>
        <p class="sub">Ø´Ø§Ø´Ø© Ø³ÙˆØ¯Ø©â€¦ 3 Ù…Ø±Ø¨Ø¹Ø§Øªâ€¦ Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„ØµØ­.</p>

        <div class="emoji-boxes">
          <div class="ebox" data-ans="no"><span>ğŸ“Œ</span></div>
          <div class="ebox" data-ans="no"><span>ğŸ§¸</span></div>
          <div class="ebox" data-ans="yes"><span>ğŸ’¡</span></div>
        </div>

        <div class="row">
          <div class="hintline" id="emojiMsg"></div>
        </div>
      </div>
    </section>

    <!-- 12) Final -->
    <section class="scene" id="sc-final">
      <div class="card">
        <h1 class="title">Ø¢Ø®Ø± Ù„ØºØ² ğŸ˜ˆ</h1>
        <p class="sub">Ø§Ø¶ØºØ·ÙŠ Ø§Ù„Ø±Ù…ÙˆØ² Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ Ø¹Ø´Ø§Ù† ÙŠÙØªØ­.</p>

        <div class="seq">
          <div class="seqbtn" data-k="moon">ğŸŒ™</div>
          <div class="seqbtn" data-k="star">â­</div>
          <div class="seqbtn" data-k="mosque">ğŸ•Œ</div>
        </div>

        <div class="row">
          <button class="btn" id="btnHint" type="button">ØªÙ„Ù…ÙŠØ­</button>
          <div class="hintline" id="finalHint"></div>
          <div class="hintline bad" id="finalErr"></div>
          <button class="btn pink" id="btnFinish" type="button" style="display:none">Ø§Ø³ØªÙ…Ø±Ø§Ø±</button>
        </div>
      </div>
    </section>

    <!-- 13) End -->
    <section class="scene" id="sc-end">
      <div class="card">
        <h1 class="title">Ø®Ù„ØµØª ğŸŠ</h1>
        <p class="sub">Ø§Ù†ØªÙŠ ÙƒØ¯Ù‡ ÙƒØ³Ø±ØªÙŠ Ø§Ù„Ø£Ù‚ÙØ§Ù„ ÙƒÙ„Ù‡Ø§â€¦ Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ… âœ¨</p>
        <button class="btn" id="btnRestartAll" type="button">Ø¥Ø¹Ø§Ø¯Ø© Ù…Ù† Ø§Ù„Ø£ÙˆÙ„</button>
      </div>
    </section>

  </main>

  <footer class="footer">ØµÙÙ†Ø¹ Ø¨ÙˆØ§Ø³Ø·Ø© : Ø¨Ù†ÙŠ Ø§Ø¯Ù… Ø¨Ø±Ø§Ø³ ÙØ±Ø®Ù‡ .</footer>

  <script>
    /***********************
     * helpers
     ***********************/
    function rand(min,max){ return Math.random()*(max-min)+min; }
    function pick(a){ return a[Math.floor(Math.random()*a.length)]; }
    function shuffle(arr){
      for(let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]]=[arr[j],arr[i]];
      }
      return arr;
    }
    function flashRed(){
      document.body.classList.add("flash-red");
      setTimeout(()=>document.body.classList.remove("flash-red"), 700);
    }

    /***********************
     * Background emojis
     ***********************/
    const emojiSky = document.getElementById("emojiSky");
    const RAMADAN_EMOJIS = ["ğŸŒ™","â˜ªï¸","âœ¨","ğŸ•Œ","â­","ğŸ‡","ğŸ’›","ğŸŒŸ","ğŸ¥®","ğŸ•¯ï¸","ğŸ“¿"];
    const EMOJI_COUNT = Math.min(26, Math.max(18, Math.floor(window.innerWidth/48)));
    for(let i=0;i<EMOJI_COUNT;i++){
      const el = document.createElement("span");
      el.className = "e";
      el.textContent = pick(RAMADAN_EMOJIS);
      el.style.left = rand(2,98) + "vw";
      el.style.setProperty("--r", rand(-35,35) + "deg");
      el.style.setProperty("--dx1", rand(-18,18).toFixed(1) + "px");
      el.style.animationDuration = rand(9.5, 16.5).toFixed(2) + "s";
      el.style.animationDelay = rand(-12, 0).toFixed(2) + "s";
      emojiSky.appendChild(el);
    }

    /***********************
     * Scene navigation + Ramadan note
     ***********************/
    const scenes = [...document.querySelectorAll(".scene")];
    function go(id){
      scenes.forEach(s => s.classList.toggle("active", s.id === id));
      window.scrollTo(0,0);
      document.body.classList.toggle("darkmode", id === "sc-emoji");
    }

    document.querySelectorAll(".glass-btn").forEach(btn=>{
      btn.addEventListener("click", ()=> go(btn.dataset.next));
    });

    const noteText = document.getElementById("noteText");
    const noteBtn  = document.getElementById("noteBtn");
    let noteNext = "sc-end";
    function showNote(text, nextId){
      noteText.innerHTML = text;
      noteNext = nextId;
      go("sc-note");
    }
    noteBtn.addEventListener("click", ()=> go(noteNext));

    /***********************
     * Puzzle 1 (password)
     ***********************/
    const pass1 = document.getElementById("pass1");
    const err1 = document.getElementById("err1");

    function normalizeArabic(s){
      return (s||"").toLowerCase().trim()
        .replace(/\s+/g,"")
        .replace(/[Ø¥Ø£Ø¢Ø§]/g,"Ø§")
        .replace(/Ù‰/g,"ÙŠ")
        .replace(/Ø¤/g,"Ùˆ")
        .replace(/Ø¦/g,"ÙŠ")
        .replace(/Ø©/g,"Ù‡")
        .replace(/[Ù€Ù‹ÙŒÙÙÙÙÙ‘Ù’]/g,"");
    }
    const ACCEPT1 = ["Ø§Ù„Ù†ÙˆÙ…","Ù†ÙˆÙ…","Ø¨Ù†Ø§Ù…"].map(normalizeArabic);

    function checkPass1(){
      err1.textContent = "";
      const v = normalizeArabic(pass1.value);
      if(ACCEPT1.includes(v)){
        showNote(
          `".. ÙˆÙ†Ø­Ù† Ù†Ø³ØªÙ‚Ø¨Ù„ Ø´Ù‡Ø± Ø§Ù„Ø®ÙŠØ±ØŒ Ø£Ø±Ø¯Øª Ø£Ù† Ø£Ø¨Ø¯Ø£Ù‡ Ø¨ÙƒÙ„Ù…Ø© <b>Ø´ÙƒØ±Ø§Ù‹</b>.<br>
          Ø´ÙƒØ±Ø§Ù‹ Ù„ØµØ¯Ù‚ÙƒÙ ÙˆÙ„Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ù„ÙˆØ© Ø§Ù„Ù„ÙŠ Ø¨ØªØ³ÙŠØ¨ÙŠÙ‡Ø§ ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù†.<br><br>
          <b>Ø±Ù…Ø¶Ø§Ù† Ù…Ø¨Ø§Ø±Ùƒ</b> Ø¹Ù„ÙŠÙƒÙ ÙˆØ¹Ù„Ù‰ Ø£Ù‡Ù„ÙƒÙ.. ÙˆÙƒÙ„ Ø³Ù†Ø© ÙˆØ¥Ù†ØªÙ Ø·ÙŠØ¨Ø© ğŸ’›"`,
          "sc-mem-intro"
        );
      }else{
        flashRed();
        err1.textContent = "ØºÙ„Ø·â€¦ Ø¬Ø±Ù‘Ø¨ÙŠ ØªØ§Ù†ÙŠ (Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù„Ø§ Ù†Ù‡Ø§Ø¦ÙŠØ©) ğŸ˜ˆ";
        err1.className = "hintline bad";
        pass1.focus();
        pass1.select?.();
      }
    }
    document.getElementById("btnPass1").addEventListener("click", checkPass1);
    pass1.addEventListener("keydown",(e)=>{
      if(e.key==="Enter"){ e.preventDefault(); checkPass1(); }
    });

    /***********************
     * Memory game (random emojis)
     ***********************/
    const memoryGrid = document.getElementById("memoryGrid");
    const memStatus = document.getElementById("memStatus");
    const btnMemContinue = document.getElementById("btnMemContinue");

    const MEM_POOL = [
      "ğŸ˜‚","ğŸ¤£","ğŸ˜­","ğŸ¥²","ğŸ˜ˆ","ğŸ™ˆ","ğŸ˜","ğŸ¤",
      "ğŸ’—","ğŸ’˜","âœ¨","ğŸŒ™","â­","ğŸ•Œ","ğŸ‰","ğŸ”¥",
      "ğŸ”","ğŸŒ","ğŸª","ğŸ’¡","ğŸ“Œ","ğŸ§¸","ğŸ‡","ğŸ“¿",
      "ğŸ˜¡","ğŸ˜±","ğŸ¤","ğŸ’€","ğŸ‘€","ğŸ¤¡","ğŸ¥³","ğŸ§ "
    ];

    function pickUnique(pool, n){
      const copy = pool.slice();
      shuffle(copy);
      return copy.slice(0, n);
    }

    let memFirst = null, memLock = false, memMatched = 0;

    function buildMemory(){
      memoryGrid.innerHTML = "";
      memFirst = null;
      memLock = false;
      memMatched = 0;
      btnMemContinue.style.display = "none";
      memStatus.textContent = `ØªÙ…: 0 / 8`;

      const chosen = pickUnique(MEM_POOL, 8);
      const deck = shuffle([...chosen, ...chosen]);

      deck.forEach((emo)=>{
        const c = document.createElement("div");
        c.className = "mcard";
        c.dataset.emo = emo;
        c.innerHTML = `<div class="mfront">â”</div><div class="mback">${emo}</div>`;

        c.addEventListener("click", ()=>{
          if(memLock) return;
          if(c.classList.contains("matched")) return;
          if(c.classList.contains("revealed")) return;

          c.classList.add("revealed");

          if(!memFirst){ memFirst = c; return; }

          const a = memFirst, b = c;
          memFirst = null;

          if(a.dataset.emo === b.dataset.emo){
            a.classList.add("matched");
            b.classList.add("matched");
            memMatched++;
            memStatus.textContent = `ØªÙ…: ${memMatched} / 8`;
            if(memMatched === 8){
              btnMemContinue.style.display = "block";
            }
          }else{
            memLock = true;
            setTimeout(()=>{
              a.classList.remove("revealed");
              b.classList.remove("revealed");
              memLock = false;
            }, 520);
          }
        });

        memoryGrid.appendChild(c);
      });
    }

    document.getElementById("btnStartMemory").addEventListener("click", ()=>{
      buildMemory();
      go("sc-memory");
    });

    // âœ… Ù‡Ù†Ø§ Ø§Ù„Ø­Ù„: Ø¨Ø¹Ø¯ Ù…Ø§ ÙŠØ¯ÙˆØ³ "Ø§Ø³ØªÙ…Ø±Ø§Ø±" ÙŠØ¸Ù‡Ø± Ø§Ù„ÙƒØ§Ø±Øª (note) ÙˆØ¨Ø¹Ø¯ÙŠÙ† ÙŠÙƒÙ…Ù„
    btnMemContinue.addEventListener("click", ()=>{
      showNote(
        `Ø§Ø³ÙÙŠÙ„ .. Ø§Ø³Ù… Ø£Ø³ÙŠÙ„ ÙŠØ­Ù…Ù„ Ù…ÙƒØ§Ù†Ø© Ø®Ø§ØµØ© Ù„Ø£Ù†Ù‡ ÙˆØ±Ø¯ ÙÙŠ ÙˆØµÙ Ø§Ù„Ù†Ø¨ÙŠ ï·º Ø¨Ø£Ù†Ù‡ ÙƒØ§Ù† "Ø£Ø³ÙŠÙ„ Ø§Ù„Ø®Ø¯ Ø§Ø³Ù… Ø£Ø³ÙŠÙ„ ÙŠØ­Ù…Ù„ Ù…ÙƒØ§Ù†Ø© Ø®Ø§ØµØ© Ù„Ø£Ù†Ù‡ ÙˆØ±Ø¯ ÙÙŠ ÙˆØµÙ Ø§Ù„Ù†Ø¨ÙŠ Ù…Ø­Ù…Ø¯ ØµÙ„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡ ÙˆØ³Ù„Ù…. ÙÙ‚Ø¯ ÙˆÙØµÙ Ø¨Ø£Ù†Ù‡ ÙƒØ§Ù† "Ø£Ø³ÙŠÙ„ Ø§Ù„Ø®Ø¯"ØŒ Ø£ÙŠ Ø£Ù† Ø®Ø¯ÙŠÙ‡ ÙƒØ§Ù†Ø§ Ù†Ø§Ø¹Ù…ÙŠÙ† ÙˆÙ…Ø³ØªÙˆÙŠÙŠÙ† (ØºÙŠØ± Ù…Ù…ØªÙ„Ø¦ÙŠÙ† Ø¨Ù„Ø­Ù… ÙƒØ«ÙŠØ± ÙˆÙ„ÙŠØ³Ø§ Ø¨Ø§Ø±Ø²ÙŠ Ø§Ù„ÙˆØ¬Ù†ØªÙŠÙ† Ø¨Ø´ÙƒÙ„ Ø­Ø§Ø¯)ØŒ Ù…Ù…Ø§ ÙŠØ¶ÙÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³Ù… Ø·Ø§Ø¨Ø¹Ø§Ù‹ Ø¬Ù…Ø§Ù„ÙŠØ§Ù‹ ÙˆÙ…Ø­Ø¨Ø¨Ø§Ù‹.
âœ¨ ØµÙØ§Øª Ø­Ø§Ù…Ù„Ø© Ø§Ø³Ù… Ø£Ø³ÙŠÙ„ (Ø­Ø³Ø¨ Ø¹Ù„Ù… Ø§Ù„Ù†ÙØ³)
ØºØ§Ù„Ø¨Ø§Ù‹ Ù…Ø§ ØªØªØ³Ù… ØµØ§Ø­Ø¨Ø© Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ø¨Ø¹Ø¯Ø© ØµÙØ§ØªØŒ Ù…Ù†Ù‡Ø§:
1. Ø§Ù„Ø±Ù‚Ø© ÙˆØ§Ù„Ø£Ù†ÙˆØ«Ø©: ÙŠØ¹ÙƒØ³ Ø§Ù„Ø§Ø³Ù… Ø·Ø¨ÙŠØ¹Ø© Ù‡Ø§Ø¯Ø¦Ø© ÙˆÙ†Ø§Ø¹Ù…Ø©.
2. Ù‚ÙˆØ© Ø§Ù„Ø´Ø®ØµÙŠØ©: Ø±ØºÙ… Ø±Ù‚ØªÙ‡Ø§ØŒ ØºØ§Ù„Ø¨Ø§Ù‹ Ù…Ø§ ØªÙƒÙˆÙ† ÙˆØ§Ø«Ù‚Ø© Ù…Ù† Ù†ÙØ³Ù‡Ø§ ÙˆØªØªØ­Ù…Ù„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©.
3. Ø§Ù„Ø°ÙƒØ§Ø¡ ÙˆØ§Ù„ØªÙ…ÙŠØ²: ØªÙ…ÙŠÙ„ Ù„Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ø¹Ù…ÙŠÙ‚ ÙˆØ§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø±Ø§Øª ØµØ§Ø¦Ø¨Ø©.
4. Ø­Ø¨ Ø§Ù„Ù‡Ø¯ÙˆØ¡: ØªØ¨ØªØ¹Ø¯ Ø¹Ø§Ø¯Ø© Ø¹Ù† Ø§Ù„Ø¶ÙˆØ¶Ø§Ø¡ ÙˆØ§Ù„Ù…Ø´Ø§ÙƒÙ„ ÙˆØªÙØ¶Ù„ Ø§Ù„Ø£Ø¬ÙˆØ§Ø¡ Ø§Ù„Ù…Ø³ØªÙ‚Ø±Ø©".<br><br>
         ÙˆÙÙŠ Ø±Ù…Ø¶Ø§Ù†â€¦ ÙƒÙ„ ÙƒÙ„Ù…Ø© Ø­Ù„ÙˆØ© Ø¨ØªÙØ±Ù‚â€¦ ÙÙ€ Ø´ÙƒØ±Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù„Ø·ÙØŒ ÙˆØ¹Ù„Ù‰ Ø§Ù„Ù‡Ø¯ÙˆØ¡ØŒ ÙˆØ¹Ù„Ù‰ Ø¥Ù† ÙˆØ¬ÙˆØ¯Ùƒ Ø¨ÙŠØ·Ù…Ù† ğŸ’›`,
        "sc-ename"
      );
    });

    /***********************
     * Puzzle 3: Emoji girl name
     ***********************/
    const enameInput = document.getElementById("enameInput");
    const enameMsg = document.getElementById("enameMsg");

    const ENAME_ACCEPT = ["Ù†ÙˆØ±","Ù†ÙˆØ±Ø§","Ù†ÙˆØ±Ù‡"].map(normalizeArabic);

    function checkEname(){
      enameMsg.textContent = "";
      const v = normalizeArabic(enameInput.value);
      if(ENAME_ACCEPT.includes(v)){
        showNote(
          `ğŸ‘ğŸ‘ Ø´Ø§Ø·Ø±Ø©!<br>
           Ø§Ù„Ø§Ø³Ù… Ù‡Ùˆ "Ù†ÙˆØ±"â€¦ Ù„Ø£Ù† Ø±Ù…Ø¶Ø§Ù† ÙƒÙ„Ù‡ <b>Ù†ÙˆØ±</b> ÙˆØ·Ù…Ø£Ù†ÙŠÙ†Ø© âœ¨ğŸŒ™<br><br>
           Ø´ÙƒØ±Ø§Ù‹ Ø¥Ù†Ùƒ ÙƒÙ…Ù‘Ù„ØªÙŠâ€¦ Ø¥Ù†ØªÙ Ø°ÙˆÙ‚.`,
          "sc-simon"
        );
      }else{
        flashRed();
        enameMsg.textContent = "Ù…Ø´ Ù‡ÙŠâ€¦ Ø±ÙƒØ²ÙŠ ÙÙŠ Ù…Ø¹Ù†Ù‰ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ² ğŸ˜ˆ";
        enameMsg.className = "hintline bad";
      }
    }
    document.getElementById("btnEnameCheck").addEventListener("click", checkEname);
    enameInput.addEventListener("keydown",(e)=>{ if(e.key==="Enter"){ e.preventDefault(); checkEname(); }});
    document.getElementById("btnEnameHint").addEventListener("click", ()=>{
      enameMsg.textContent = "ØªÙ„Ù…ÙŠØ­: Ù…Ø¹Ù†Ù‰ Ø§Ù„Ø§Ø³Ù… = Ø§Ù„Ø¶ÙˆØ¡.";
      enameMsg.className = "hintline";
    });

    /***********************
     * Puzzle 4: Simon
     ***********************/
    const pads = [...document.querySelectorAll(".pad")];
    const simonMsg = document.getElementById("simonMsg");
    const btnSimonStart = document.getElementById("btnSimonStart");
    const btnSimonReplay = document.getElementById("btnSimonReplay");

    let simonSeq = [];
    let simonPos = 0;
    let simonPlaying = false;
    let simonReady = false;

    function flashPad(i){
      return new Promise(res=>{
        pads[i].classList.add("on");
        setTimeout(()=>{
          pads[i].classList.remove("on");
          setTimeout(res, 130);
        }, 320);
      });
    }

    async function playSeq(){
      simonPlaying = true;
      simonReady = false;
      simonMsg.textContent = "Ø´Ø§Ù‡Ø¯ÙŠ Ø§Ù„ØªØ±ØªÙŠØ¨â€¦";
      for(const i of simonSeq){
        await flashPad(i);
      }
      simonPlaying = false;
      simonReady = true;
      simonPos = 0;
      simonMsg.textContent = "Ø¯ÙˆØ±Ùƒâ€¦ ÙƒØ±Ø±ÙŠ Ø§Ù„ØªØ±ØªÙŠØ¨.";
      btnSimonReplay.style.display = "block";
    }

    function startSimon(){
      simonSeq = Array.from({length:6}, ()=> Math.floor(Math.random()*4)); // ØµØ¹Ø¨
      playSeq();
    }

    btnSimonStart.addEventListener("click", ()=>{
      if(simonPlaying) return;
      startSimon();
    });
    btnSimonReplay.addEventListener("click", ()=>{
      if(simonPlaying || !simonSeq.length) return;
      playSeq();
    });

    pads.forEach(p=>{
      p.addEventListener("click", async ()=>{
        if(!simonReady || simonPlaying) return;
        const i = Number(p.dataset.i);

        // feedback ØµØºÙŠØ±
        p.classList.add("on");
        setTimeout(()=>p.classList.remove("on"), 160);

        if(i === simonSeq[simonPos]){
          simonPos++;
          if(simonPos === simonSeq.length){
            simonReady = false;
            showNote(
              `ğŸ”¥ Ø¬Ø§Ù…Ø¯Ø©! Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø¹Ù†Ø¯Ùƒ ÙÙˆÙ„ Ø£ÙˆØ¨Ø´Ù†.<br><br>
               ÙÙŠ Ø±Ù…Ø¶Ø§Ù†â€¦ Ø§Ù„Ù„Ø·Ù Ø¨ÙŠØ¨Ø§Ù† ÙÙŠ Ø§Ù„ØªÙØ§ØµÙŠÙ„â€¦ Ø´ÙƒØ±Ø§Ù‹ Ø¹Ù„Ù‰ Ø¥Ù†Ùƒ Ù…Ø±ÙƒÙ‘Ø²Ø© ÙˆÙ…ÙƒÙ…Ù„Ø© ğŸ’›`,
              "sc-word"
            );
          }
        }else{
          flashRed();
          simonMsg.textContent = "ØºÙ„Ø·â€¦ Ù…Ù† Ø§Ù„Ø£ÙˆÙ„ ğŸ˜ˆ Ø§Ø¶ØºØ·ÙŠ (Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶).";
          simonMsg.className = "hintline bad";
          simonReady = true;
          simonPos = 0;
        }
      });
    });

    /***********************
     * Puzzle 5: Word build (target: Ø§Ù„Ø±Ø­Ù…Ø©)
     ***********************/
    const tilesEl = document.getElementById("tiles");
    const builtEl = document.getElementById("built");
    const wordMsg = document.getElementById("wordMsg");

    const TARGET_WORD = "Ø§Ù„Ø±Ø­Ù…Ø©";
    let availableTiles = [];
    let built = "";

    function setupWord(){
      built = "";
      builtEl.textContent = "...";
      wordMsg.textContent = "";
      wordMsg.className = "hintline";

      availableTiles = shuffle(TARGET_WORD.split(""));
      renderTiles();
    }

    function renderTiles(){
      tilesEl.innerHTML = "";
      availableTiles.forEach((ch, idx)=>{
        const t = document.createElement("div");
        t.className = "tile";
        t.textContent = ch;
        t.addEventListener("click", ()=>{
          built += ch;
          availableTiles.splice(idx,1);
          builtEl.textContent = built || "...";
          renderTiles();
          checkWord();
        });
        tilesEl.appendChild(t);
      });
    }

    function checkWord(){
      if(built.length === TARGET_WORD.length){
        if(built === TARGET_WORD){
          showNote(
            `âœ… ØµØ­! "<b>Ø§Ù„Ø±Ø­Ù…Ø©</b>"â€¦ ÙˆØ¯ÙŠ Ø£ÙƒØªØ± Ø­Ø§Ø¬Ø© Ø¨Ù†Ø­Ø³Ù‡Ø§ ÙÙŠ Ø±Ù…Ø¶Ø§Ù†.<br><br>
             Ø´ÙƒØ±Ù‹Ø§ Ø¹Ù„Ù‰ Ø¥Ù†Ùƒ Ø¨ØªÙƒÙ…Ù„ÙŠâ€¦ ÙˆØ¬ÙˆØ¯Ùƒ Ù…ÙØ±ÙŠØ­ ğŸ’›`,
            "sc-doors"
          );
        }else{
          flashRed();
          wordMsg.textContent = "Ø§Ù„ØªØ±ØªÙŠØ¨ ØºÙ„Ø·â€¦ Ø¬Ø±Ù‘Ø¨ÙŠ ØªØ§Ù†ÙŠ ğŸ˜ˆ";
          wordMsg.className = "hintline bad";
        }
      }
    }

    document.getElementById("btnWordBack").addEventListener("click", ()=>{
      if(!built.length) return;
      const last = built[built.length-1];
      built = built.slice(0,-1);
      availableTiles.push(last);
      builtEl.textContent = built || "...";
      renderTiles();
    });
    document.getElementById("btnWordReset").addEventListener("click", setupWord);
    document.getElementById("btnWordHint").addEventListener("click", ()=>{
      wordMsg.textContent = "ØªÙ„Ù…ÙŠØ­: ÙƒÙ„Ù…Ø© Ù…Ø¹Ù†Ø§Ù‡Ø§ (Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ø¨Ù„Ø·Ù + Ù…ØºÙØ±Ø© + Ø·ÙŠØ¨Ø©).";
      wordMsg.className = "hintline";
    });

    // initialize word puzzle once scene opens (weâ€™ll call setupWord before going)
    // We'll call it right before entering sc-word via note (already does), but safe:
    setupWord();

    /***********************
     * Puzzle 6: Doors logic
     ***********************/
    const doorsMsg = document.getElementById("doorsMsg");
    const CORRECT_DOOR = 1; // Ø­Ø³Ø¨ Ù…Ù†Ø·Ù‚ "Ø¬Ù…Ù„Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· ØµØ­"

    document.querySelectorAll(".door").forEach(d=>{
      d.addEventListener("click", ()=>{
        doorsMsg.textContent = "";
        const n = Number(d.dataset.door);
        if(n === CORRECT_DOOR){
          showNote(
            `ğŸšªâœ… ØµØ­! (Ø§Ù„Ø¨Ø§Ø¨ Ø§Ù„Ø£ÙˆÙ„ Ù‡Ùˆ Ø§Ù„Ø­Ù„).<br><br>
             Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ…â€¦ ÙˆØ´ÙƒØ±Ø§Ù‹ Ø¥Ù†Ùƒ Ø°ÙƒÙŠØ© ÙƒÙØ§ÙŠØ© ØªÙƒØ³Ø±ÙŠ Ø§Ù„Ù„ØºØ² Ø¯Ù‡ ğŸ˜ˆğŸ’›`,
            "sc-xo"
          );
        }else{
          flashRed();
          doorsMsg.textContent = "ØºÙ„Ø·â€¦ ÙÙƒØ±ÙŠ ÙÙŠ Ø´Ø±Ø· (Ø¬Ù…Ù„Ø© ÙˆØ§Ø­Ø¯Ø© Ø¨Ø³ ØµØ­) ğŸ‘€";
          doorsMsg.className = "hintline bad";
        }
      });
    });

    document.getElementById("btnDoorsHint").addEventListener("click", ()=>{
      doorsMsg.textContent = "ØªÙ„Ù…ÙŠØ­: Ø¬Ø±Ù‘Ø¨ÙŠ ØªÙØªØ±Ø¶ÙŠ Ø§Ù„Ø¨Ø§Ø¨ Ø§Ù„ØµØ­â€¦ ÙˆØ´ÙˆÙÙŠ ÙƒØ§Ù… Ø¬Ù…Ù„Ø© Ù‡ØªØ¨Ù‚Ù‰ ØµØ­.";
      doorsMsg.className = "hintline";
    });

    /***********************
     * XO game (win -> note -> message form)
     ***********************/
    const xoBoardEl = document.getElementById("xoBoard");
    const xoStatus = document.getElementById("xoStatus");
    const xoRestart = document.getElementById("xoRestart");

    let xo = Array(9).fill(null);
    let xoOver = false;

    function winner(b){
      const lines = [
        [0,1,2],[3,4,5],[6,7,8],
        [0,3,6],[1,4,7],[2,5,8],
        [0,4,8],[2,4,6]
      ];
      for(const [a,c,d] of lines){
        if(b[a] && b[a]===b[c] && b[a]===b[d]) return b[a];
      }
      if(b.every(Boolean)) return "draw";
      return null;
    }

    function score(b){
      const w = winner(b);
      if(w==="â­•") return 10;
      if(w==="âŒ") return -10;
      return 0;
    }
    function minimax(b, depth, isMax, maxDepth){
      const w = winner(b);
      if(w || depth === maxDepth) return score(b);

      const empties = b.map((v,i)=>v?null:i).filter(v=>v!==null);
      if(isMax){
        let best = -Infinity;
        for(const i of empties){
          b[i] = "â­•";
          best = Math.max(best, minimax(b, depth+1, false, maxDepth));
          b[i] = null;
        }
        return best - depth*0.2;
      }else{
        let best = Infinity;
        for(const i of empties){
          b[i] = "âŒ";
          best = Math.min(best, minimax(b, depth+1, true, maxDepth));
          b[i] = null;
        }
        return best + depth*0.2;
      }
    }
    function bestMove(b){
      const empties = b.map((v,i)=>v?null:i).filter(v=>v!==null);
      if(Math.random() < 0.18){
        return empties[Math.floor(Math.random()*empties.length)];
      }
      let best = -Infinity, move = empties[0];
      for(const i of empties){
        b[i] = "â­•";
        const val = minimax(b, 0, false, 4);
        b[i] = null;
        if(val > best){ best = val; move = i; }
      }
      return move;
    }

    function renderXO(){
      xoBoardEl.innerHTML = "";
      xo.forEach((v, idx)=>{
        const cell = document.createElement("div");
        cell.className = "xo-cell" + (xoOver ? " disabled" : "");
        cell.textContent = v || "";
        cell.addEventListener("click", ()=>{
          if(xoOver) return;
          if(xo[idx]) return;
          xo[idx] = "âŒ";
          afterMove();
        });
        xoBoardEl.appendChild(cell);
      });
    }

    function afterMove(){
      renderXO();
      let w = winner(xo);
      if(w){ endXO(w); return; }

      xoStatus.textContent = "Ø¯ÙˆØ± Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±â€¦";
      setTimeout(()=>{
        const m = bestMove(xo.slice());
        if(m !== undefined && m !== null) xo[m] = "â­•";
        renderXO();
        w = winner(xo);
        if(w) endXO(w);
        else xoStatus.textContent = "Ø¯ÙˆØ±Ùƒ.";
      }, 360);
    }

    function endXO(w){
      xoOver = true;
      if(w === "âŒ"){
        showNote(
          `ğŸ‰ ÙØ²ØªÙŠ! Ø®Ù„Ø§Øµ ÙƒØ¯Ù‡â€¦ Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ… Ø¹Ù„ÙŠÙƒÙ ğŸ’›<br><br>
           Ø¬Ø§ÙŠØ© Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù„ÙŠ ØªÙƒØªØ¨ÙŠ ÙÙŠÙ‡Ø§ Ø§Ù„Ù„ÙŠ ÙÙŠ Ù‚Ù„Ø¨Ùƒâ€¦`,
          "sc-message"
        );
      }else if(w === "â­•"){
        xoStatus.textContent = "Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ÙƒØ³Ø¨â€¦ Ø¬Ø±Ù‘Ø¨ÙŠ ØªØ§Ù†ÙŠ ğŸ˜ˆ";
      }else{
        xoStatus.textContent = "ØªØ¹Ø§Ø¯Ù„â€¦ Ø¹Ø§ÙŠØ²ÙŠÙ† ÙÙˆØ² ğŸ˜­";
      }
    }

    function resetXO(){
      xo = Array(9).fill(null);
      xoOver = false;
      xoStatus.textContent = "Ø¯ÙˆØ±Ùƒ.";
      renderXO();
    }

    xoRestart.addEventListener("click", resetXO);
    resetXO();

    /***********************
     * Formspree submit -> note -> black emoji
     ***********************/
    const msgForm = document.getElementById("msgForm");
    const msgText = document.getElementById("msgText");
    const msgPage = document.getElementById("msgPage");
    const msgSend = document.getElementById("msgSend");
    const msgHint = document.getElementById("msgHint");

    msgForm.addEventListener("submit", async (e)=>{
      e.preventDefault();

      const gotcha = msgForm.querySelector('[name="_gotcha"]').value;
      if(gotcha) return;

      const msg = (msgText.value || "").trim();
      if(!msg){
        flashRed();
        msgText.focus();
        return;
      }

      msgPage.value = location.href;
      msgSend.disabled = true;
      msgHint.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

      try{
        const fd = new FormData(msgForm);

        let res = await fetch(msgForm.action, {
          method: "POST",
          body: fd,
          headers: { "Accept":"application/json" }
        });

        if(!res.ok){
          const payload = new URLSearchParams();
          for (const [k,v] of fd.entries()) payload.append(k, String(v));
          res = await fetch(msgForm.action, {
            method: "POST",
            headers: {
              "Accept":"application/json",
              "Content-Type":"application/x-www-form-urlencoded"
            },
            body: payload.toString()
          });
        }

        const data = await res.json().catch(()=>({}));
        if(!res.ok){
          const m = data?.error || data?.message || "Ù…Ø±ÙÙˆØ¶";
          msgHint.textContent = `ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ (${res.status}): ${m}`;
          msgHint.className = "hintline bad";
          flashRed();
          msgSend.disabled = false;
          return;
        }

        msgSend.disabled = false;
        msgHint.textContent = "ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ âœ…";
        msgHint.className = "hintline ok";

        showNote(
          `ÙˆØµÙ„Øª âœ…<br><br>
           Ø´ÙƒØ±Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø©â€¦ ÙˆØ±Ø¨Ù†Ø§ ÙŠØ¬Ø¹Ù„ Ø±Ù…Ø¶Ø§Ù† Ø¯Ø§ÙŠÙ…Ù‹Ø§ Ø¨Ø¯Ø§ÙŠØ© Ø®ÙŠØ± ÙˆØ±Ø§Ø­Ø© Ù„ÙŠÙƒÙ ğŸ’›`,
          "sc-emoji"
        );

      }catch(err){
        msgHint.textContent = "ÙØ´Ù„ Ø§ØªØµØ§Ù„/Ø­Ø¸Ø± Ù…Ù† Ø¥Ø¶Ø§ÙØ©. Ø¬Ø±Ù‘Ø¨ÙŠ Incognito.";
        msgHint.className = "hintline bad";
        flashRed();
        msgSend.disabled = false;
      }
    });

    /***********************
     * Black emoji puzzle -> note -> final
     ***********************/
    const emojiMsg = document.getElementById("emojiMsg");
    document.querySelectorAll(".ebox").forEach(box=>{
      box.addEventListener("click", ()=>{
        if(box.dataset.ans === "yes"){
          emojiMsg.textContent = "ØµØ­ âœ…";
          emojiMsg.className = "hintline ok";
          showNote(
            `Ø¢Ø®Ø± ÙˆØ§Ø­Ø¯â€¦ Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ… ğŸ’›<br>
             Ø´ÙƒØ±Ø§Ù‹ Ø¥Ù†Ùƒ ÙˆØµÙ„ØªÙŠ Ù„Ù„Ø¢Ø®Ø±â€¦`,
            "sc-final"
          );
        }else{
          flashRed();
          emojiMsg.textContent = "ØºÙ„Ø·â€¦ Ø¬Ø±Ù‘Ø¨ÙŠ ØªØ§Ù†ÙŠ ğŸ˜ˆ";
          emojiMsg.className = "hintline bad";
        }
      });
    });

    /***********************
     * Final sequence puzzle -> end
     ***********************/
    const seq = [];
    const finalHint = document.getElementById("finalHint");
    const finalErr = document.getElementById("finalErr");
    const btnHint = document.getElementById("btnHint");
    const btnFinish = document.getElementById("btnFinish");
    const TARGET = ["moon","star","mosque"];

    function resetSeq(){
      seq.length = 0;
      finalErr.textContent = "";
      btnFinish.style.display = "none";
    }

    document.querySelectorAll(".seqbtn").forEach(b=>{
      b.addEventListener("click", ()=>{
        finalErr.textContent = "";
        seq.push(b.dataset.k);

        for(let i=0;i<seq.length;i++){
          if(seq[i] !== TARGET[i]){
            finalErr.textContent = "Ø§Ù„ØªØ±ØªÙŠØ¨ ØºÙ„Ø·â€¦ Ù…Ù† Ø§Ù„Ø£ÙˆÙ„ ğŸ˜ˆ";
            flashRed();
            resetSeq();
            return;
          }
        }

        if(seq.length === TARGET.length){
          btnFinish.style.display = "block";
          finalHint.textContent = "Ø§ØªÙØªØ­ âœ…";
          finalHint.className = "hintline ok";
        }else{
          finalHint.textContent = `ØªÙ…Ø§Ù…â€¦ ÙƒÙ…Ù„ÙŠ (${seq.length}/3)`;
          finalHint.className = "hintline";
        }
      });
    });

    btnHint.addEventListener("click", ()=>{
      finalHint.textContent = "Ø§Ø¨Ø¯Ø£ÙŠ Ø¨Ø§Ù„Ù„ÙŠÙ„â€¦ Ø¨Ø¹Ø¯Ù‡ Ø§Ù„Ù„Ù…Ø¹Ø©â€¦ Ø¢Ø®Ø± Ø­Ø§Ø¬Ø© Ù…ÙƒØ§Ù† Ø§Ù„ØµÙ„Ø§Ø©.";
      finalHint.className = "hintline";
    });

    btnFinish.addEventListener("click", ()=>{
      showNote(
        `ğŸŠ Ø®Ù„ØµØª Ø§Ù„Ø±Ø­Ù„Ø©!<br><br>
         Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ…â€¦ ÙˆØ´ÙƒØ±Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù„Ùˆ ğŸ’›`,
        "sc-end"
      );
    });

    /***********************
     * Restart
     ***********************/
    document.getElementById("btnRestartAll").addEventListener("click", ()=>{
      pass1.value = "";
      err1.textContent = "";

      // memory
      memFirst = null; memLock = false; memMatched = 0;
      btnMemContinue.style.display = "none";
      memStatus.textContent = "ØªÙ…: 0 / 8";
      memoryGrid.innerHTML = "";

      // name
      enameInput.value = "";
      enameMsg.textContent = "";

      // simon
      simonSeq = [];
      simonPos = 0;
      simonPlaying = false;
      simonReady = false;
      simonMsg.textContent = "";
      btnSimonReplay.style.display = "none";

      // word
      setupWord();

      // xo
      resetXO();

      // msg
      msgText.value = "";
      msgHint.textContent = "";
      msgSend.disabled = false;

      // emoji
      emojiMsg.textContent = "";

      // final
      finalHint.textContent = "";
      finalErr.textContent = "";
      resetSeq();

      go("sc-who");
    });

    // start at who
    go("sc-who");
  </script>
</body>
</html>
